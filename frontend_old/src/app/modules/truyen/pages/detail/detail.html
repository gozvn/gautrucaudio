<app-header></app-header>
    <div class="container-md py-4">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Story Info Section -->
                <div *ngIf="detailTruyen" class="card border-0 mb-4">
                    <div class="card-body">
                        <div class="row">
                            <h1 class="fs-2 text-primary mb-3">{{detailTruyen.title}}</h1>
                            <div class="col-md-6 col-sm-4 mb-3">
                                <img src="{{detailTruyen.thumbnail_link}}" 
                                     class="img-fluid border" alt="{{detailTruyen.title}}">
                            </div>
                            <div class="col-md-6 col-sm-8">
                                <!-- Rating Stars -->
                                <!-- <div class="mb-3">
                                    <span class="text-warning">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star"></i>
                                    </span>
                                    <small class="text-muted ms-2">Chưa có đánh giá nào, bạn hãy là người đầu tiên đánh giá truyện này!</small>
                                </div> -->
                                <!-- Action Buttons -->
                                <div class="mb-3">
                                    <button class="btn btn-success me-1 mb-2">
                                        <i class="bi bi-headphones"></i> Nghe bộ truyện này
                                    </button>
                                    <button class="btn btn-primary me-1 mb-2">
                                        <i class="bi bi-book"></i> Đọc bộ truyện này
                                    </button>
                                    <!-- <button class="btn btn-outline-danger mb-2">
                                        <i class="bi bi-heart"></i> Yêu thích
                                    </button> -->
                                </div>
                            </div>
                            <!-- Story TAGS -->
                            <div class="row">
                                <div class="col-sm-6">
                                    <p><strong>Tác giả:</strong> <span class="text-info">Bach Tố Chúc Bach</span></p>
                                    <p><strong>Thể loại:</strong> <span class="text-info">Huyền Huyễn, Dị Năng, Nữ Cường, Khác, Hệ Thống</span></p>
                                </div>
                                <div class="col-sm-6">
                                    <p><strong>Nguồn:</strong> <span class="text-info">Cà Mèn</span></p>
                                    <p><strong>Trạng thái:</strong> <span class="badge bg-success">Full</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Story Description -->
                <div class="card mb-4">
                    <h3 class="card-header">Giới Thiệu : </h3>
                    <div class="card-body keep-newlines">
                      {{detailTruyen.description}}
                    </div>
                </div>

                <!-- Chapter List -->
                <div class="card">
                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">DANH SÁCH CHƯƠNG</h5>
                        <span class="badge bg-light text-dark">Tổng: 156 chương</span>
                    </div>
                    <div class="card-body">
                        <!-- Loading Spinner -->
                        <div id="chapterLoading" class="text-center py-4 d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="mt-2">Đang tải chương...</div>
                        </div>

                        <!-- Chapter Content -->
                        <div id="chapterContent">
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 1: Hến nhắt và giá vớ không hề mâu thuẫn
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 2: Truyện tranh đã được cập nhật
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 3: Sự hồi sinh tạm thời
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 4: Xâm nhập tông bộ
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 5: Không thể triệu chọc
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 6: Giá yếu?
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 7: Hai thần phân
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 8: Thần bí thiếu nữ
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 9: Bí mật được tiết lộ
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 10: Kết thúc chương đầu
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 11: Khởi đầu mới
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 12: Sức mạnh thực sự
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 13: Đối đầu
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 14: Bí ẩn dần hé lộ
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 15: Cuộc chiến lớn
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 16: Thắng lợi bất ngờ
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 17: Hậu quả
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 18: Tình bạn mới
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 19: Kế hoạch tiếp theo
                                            </a>
                                        </li>
                                        <li class="mb-2">
                                            <a href="#" class="text-decoration-none">
                                                <i class="bi bi-play-circle text-primary"></i>
                                                Chương 20: Chặng đường mới
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Chapter pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                        <i class="bi bi-chevron-left"></i> Trước
                                    </a>
                                </li>
                                <li class="page-item active">
                                    <a class="page-link" href="#" data-page="1">1</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="2">2</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="3">3</a>
                                </li>
                                <li class="page-item">
                                    <span class="page-link">...</span>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="8">8</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="#" data-page="2">
                                        Sau <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>

                        <!-- Chapter Info -->
                        <div class="row text-center text-muted small mt-3">
                            <div class="col-md-4">
                                <i class="bi bi-book"></i> Trang 1/8
                            </div>
                            <div class="col-md-4">
                                <i class="bi bi-list-ol"></i> 20 chương/trang
                            </div>
                            <div class="col-md-4">
                                <i class="bi bi-collection"></i> Hiển thị 1-20/156
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <app-sidebar></app-sidebar>
            </div>  
        </div>
    </div>
    <script>
        // Chapter Pagination Data - Mô phỏng dữ liệu từ server
        const chapterData = {
            1: [
                { id: 1, title: "Hến nhắt và giá vớ không hề mâu thuẫn" },
                { id: 2, title: "Truyện tranh đã được cập nhật" },
                { id: 3, title: "Sự hồi sinh tạm thời" },
                { id: 4, title: "Xâm nhập tông bộ" },
                { id: 5, title: "Không thể triệu chọc" },
                { id: 6, title: "Giá yếu?" },
                { id: 7, title: "Hai thần phân" },
                { id: 8, title: "Thần bí thiếu nữ" },
                { id: 9, title: "Bí mật được tiết lộ" },
                { id: 10, title: "Kết thúc chương đầu" },
                { id: 11, title: "Khởi đầu mới" },
                { id: 12, title: "Sức mạnh thực sự" },
                { id: 13, title: "Đối đầu" },
                { id: 14, title: "Bí ẩn dần hé lộ" },
                { id: 15, title: "Cuộc chiến lớn" },
                { id: 16, title: "Thắng lợi bất ngờ" },
                { id: 17, title: "Hậu quả" },
                { id: 18, title: "Tình bạn mới" },
                { id: 19, title: "Kế hoạch tiếp theo" },
                { id: 20, title: "Chặng đường mới" }
            ],
            2: [
                { id: 21, title: "Thử thách mới" },
                { id: 22, title: "Sức mạnh tiềm ẩn" },
                { id: 23, title: "Cuộc gặp gỡ định mệnh" },
                { id: 24, title: "Bí mật gia tộc" },
                { id: 25, title: "Trận chiến cuối cùng" },
                { id: 26, title: "Áo choàng mới xuất hiện" },
                { id: 27, title: "Nhiệm vụ cấp SSS" },
                { id: 28, title: "Giao điểm của vận mệnh" },
                { id: 29, title: "Hắc Cách bị chửi thì có liên quan gì đến Lê Lê cơ..." },
                { id: 30, title: "Tìm đến" },
                { id: 31, title: "Đã hẹn là không cosplay mà" },
                { id: 32, title: "Hội chợ truyện tranh" },
                { id: 33, title: "Khám phá bí ẩn" },
                { id: 34, title: "Đồng minh bất ngờ" },
                { id: 35, title: "Kế hoạch phản công" },
                { id: 36, title: "Cuộc đua với thời gian" },
                { id: 37, title: "Sự thật được phơi bày" },
                { id: 38, title: "Lựa chọn khó khăn" },
                { id: 39, title: "Tình huống nguy hiểm" },
                { id: 40, title: "Điểm bước ngoặt" }
            ],
            3: [
                { id: 41, title: "Chương mới bắt đầu" },
                { id: 42, title: "Thế giới khác" },
                { id: 43, title: "Năng lực đặc biệt" },
                { id: 44, title: "Cuộc phiêu lưu" },
                { id: 45, title: "Gặp gỡ đối thủ" },
                { id: 46, title: "Trận đấu quyết định" },
                { id: 47, title: "Chiến thắng ngoạn mục" },
                { id: 48, title: "Hậu quả không ngờ" },
                { id: 49, title: "Tìm kiếm manh mối" },
                { id: 50, title: "Khám phá sức mạnh" },
                { id: 51, title: "Đối mặt thực tế" },
                { id: 52, title: "Quyết định quan trọng" },
                { id: 53, title: "Cuộc hành trình mới" },
                { id: 54, title: "Thử thách lớn nhất" },
                { id: 55, title: "Bước ngoặt định mệnh" },
                { id: 56, title: "Sự hy sinh cao cả" },
                { id: 57, title: "Hy vọng cuối cùng" },
                { id: 58, title: "Chiến đấu đến cùng" },
                { id: 59, title: "Kết thúc một chương" },
                { id: 60, title: "Khởi đầu tương lai" }
            ]
        };

        let currentPage = 1;
        const totalPages = 8;
        const totalChapters = 156;
        const chaptersPerPage = 20;

        // Function to load chapters via Ajax simulation
        function loadChapters(page) {
            // Show loading
            document.getElementById('chapterLoading').classList.remove('d-none');
            document.getElementById('chapterContent').style.opacity = '0.5';

            // Simulate Ajax delay
            setTimeout(() => {
                const chapters = chapterData[page] || chapterData[1];
                renderChapters(chapters);
                updatePagination(page);
                
                // Hide loading
                document.getElementById('chapterLoading').classList.add('d-none');
                document.getElementById('chapterContent').style.opacity = '1';
                
                // Smooth scroll to chapter list
                document.querySelector('.card-header').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 800);
        }

        // Function to render chapters
        function renderChapters(chapters) {
            const contentDiv = document.getElementById('chapterContent');
            const col1Chapters = chapters.slice(0, 10);
            const col2Chapters = chapters.slice(10, 20);

            contentDiv.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            ${col1Chapters.map(chapter => `
                                <li class="mb-2">
                                    <a href="#" class="text-decoration-none">
                                        <i class="bi bi-play-circle text-primary"></i>
                                        Chương ${chapter.id}: ${chapter.title}
                                    </a>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            ${col2Chapters.map(chapter => `
                                <li class="mb-2">
                                    <a href="#" class="text-decoration-none">
                                        <i class="bi bi-play-circle text-primary"></i>
                                        Chương ${chapter.id}: ${chapter.title}
                                    </a>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        // Function to update pagination
        function updatePagination(page) {
            currentPage = page;
            const pagination = document.querySelector('.pagination');
            
            // Calculate visible page numbers
            let startPage = Math.max(1, page - 1);
            let endPage = Math.min(totalPages, page + 1);
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${page === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${page - 1}" tabindex="${page === 1 ? '-1' : ''}">
                        <i class="bi bi-chevron-left"></i> Trước
                    </a>
                </li>
            `;
            
            // First page
            if (startPage > 1) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="1">1</a>
                    </li>
                `;
                if (startPage > 2) {
                    paginationHTML += '<li class="page-item"><span class="page-link">...</span></li>';
                }
            }
            
            // Visible pages
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === page ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                    </li>
                `;
            }
            
            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += '<li class="page-item"><span class="page-link">...</span></li>';
                }
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a>
                    </li>
                `;
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${page === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${page + 1}" tabindex="${page === totalPages ? '-1' : ''}">
                        Sau <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
            
            // Update chapter info
            const startChapter = (page - 1) * chaptersPerPage + 1;
            const endChapter = Math.min(page * chaptersPerPage, totalChapters);
            
            document.querySelector('.row.text-center.text-muted').innerHTML = `
                <div class="col-md-4">
                    <i class="bi bi-book"></i> Trang ${page}/${totalPages}
                </div>
                <div class="col-md-4">
                    <i class="bi bi-list-ol"></i> ${chaptersPerPage} chương/trang
                </div>
                <div class="col-md-4">
                    <i class="bi bi-collection"></i> Hiển thị ${startChapter}-${endChapter}/${totalChapters}
                </div>
            `;
        }

        // Event delegation for pagination clicks
        document.addEventListener('click', function(e) {
            if (e.target.closest('.page-link') && e.target.closest('.page-link').dataset.page) {
                e.preventDefault();
                const page = parseInt(e.target.closest('.page-link').dataset.page);
                if (page && page !== currentPage && page >= 1 && page <= totalPages) {
                    loadChapters(page);
                }
            }
        });

        // Hot stories filter functionality
        document.addEventListener('change', function(e) {
            if (e.target.name === 'filter') {
                // Add loading effect to hot stories
                const hotStoriesList = document.querySelector('.list-group.list-group-flush');
                hotStoriesList.style.opacity = '0.5';
                
                setTimeout(() => {
                    hotStoriesList.style.opacity = '1';
                    // Here you would typically load different data based on filter
                    console.log('Filter changed to:', e.target.id);
                }, 500);
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updatePagination(1);
        });
    </script>
<app-footer></app-footer>